{"version":3,"file":"d2v-transition-js.js","sources":["../../../../../d2v-transition-common/src/main/kotlin/io/data2viz/transition/Transition.kt"],"sourcesContent":["package io.data2viz.transition\n\n\nimport io.data2viz.ease.ease\nimport io.data2viz.timer.timer\nimport io.data2viz.viz.StateManager\nimport io.data2viz.viz.StateManagerStatus\nimport io.data2viz.viz.StateableElement\n\n\ninline fun <reified T : StateableElement> T.transitionTo(\n    delay: Double = 0.0,\n    duration: Double = 1000.0,\n    noinline easing: (Double) -> Double = ease.cubicInOut,\n    noinline configure: T.() -> Unit\n) =\n    Transition(this, configure, true, delay, duration, easing)\n\nclass Transition<T : StateableElement>(\n    private val target: T,\n    private val configure: T.() -> Unit,\n    rootTransition: Boolean,\n    var delay: Double = 0.0,\n    var duration: Double,\n    var easing: (Double) -> Double = ease.cubicInOut\n\n) {\n    private var next: Transition<T>? = null\n\n    init {\n\n        if (rootTransition)\n            scheduleTransition()\n    }\n\n    /**\n     * Asynchronously ran, all the properties are set.\n     */\n    private fun scheduleTransition() {\n        val stateManager = StateManager()\n        target.stateManager = stateManager\n        stateManager.status = StateManagerStatus.RECORD\n        configure(target)\n        stateManager.status = StateManagerStatus.REST\n        timer(delay) { time ->\n            var percent = time / duration\n            if (percent > .999999) {\n                stop()\n                percent = 1.0\n            }\n            stateManager.percentToState(easing(percent))\n            if (percent == 1.0) {\n                next?.scheduleTransition()\n            }\n        }\n    }\n\n    fun thenTransitionTo(\n        delay: Double = 0.0,\n        duration: Double = 1000.0,\n        easing: (Double) -> Double = ease.cubicInOut,\n        configure: T.() -> Unit\n    ): Transition<T> {\n        val ret = Transition(target, configure, false, delay, duration, easing)\n        this.next = ret\n        return ret\n    }\n\n\n}"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;2GAUA,yB;IAAA,sE;IAAA,yD;IAAA,0E;MACI,qB;QAAA,QAAgB,G;MAChB,wB;QAAA,WAAmB,M;MACnB,sB;QAAA,SAAsC,cAAK,W;MAG3C,2BAAW,SAAX,EAAiB,SAAjB,EAA4B,IAA5B,EAAkC,KAAlC,EAAyC,QAAzC,EAAmD,MAAnD,C;IAAA,C;GANJ,C;;IAYI,qB;MAAA,QAAoB,G;IAEpB,sB;MAAA,SAAiC,cAAK,W;IALtC,sB;IACA,4B;IAEA,kB;IACA,wB;IACA,oB;IAGA,cAAmC,I;IAI/B,IAAI,cAAJ,C;MACI,2B;EAd0B,C;;IA0BjB,kC;MAQL,Q;MAPJ,cAAc,OAAO,wB;MACrB,IAAI,UAAU,QAAd,C;QACI,gB;QACA,UAAU,G;;MAEd,oBAAa,wBAAe,uBAAO,OAAP,CAAf,C;MACb,IAAI,YAAW,GAAf,C;QACI,oF;;MAER,W;IAVa,C;EAAA,C;;IALb,mBAAmB,kB;IACnB,6BAAsB,Y;IACtB,+C;IACA,iBAAU,aAAV,C;IACA,6C;IACA,MAAM,UAAN,UAAa,wDAAb,C;EAWJ,C;;IAGI,qB;MAAA,QAAgB,G;IAChB,wB;MAAA,WAAmB,M;IACnB,sB;MAAA,SAA6B,cAAK,W;IAGlC,UAAU,eAAW,aAAX,EAAmB,SAAnB,EAA8B,KAA9B,EAAqC,KAArC,EAA4C,QAA5C,EAAsD,MAAtD,C;IACV,cAAY,G;IACZ,OAAO,G;EACX,C;;;;;;;;;;;;;;"}